<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chai Vision Sales Dashboard - Full Channel Management</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Real-time sales performance tracking across all channels with KPI monitoring and data visualization">
    <meta name="keywords" content="sales dashboard, KPI tracking, business analytics, channel management">
    <meta name="author" content="Chai Vision">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Chai Vision Sales Dashboard">
    <meta property="og:description" content="Real-time sales performance tracking across all channels">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com">
    <meta property="og:image" content="https://your-domain.com/preview.png">
    
    <!-- Performance Optimizations -->
    <link rel="dns-prefetch" href="//unpkg.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://unpkg.com/react@18/umd/react.production.min.js" as="script">
    <link rel="preload" href="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" as="script">
    <link rel="preload" href="src/styles/main.css" as="style">
    
    <!-- Favicon (fallback emoji used; public assets removed) -->
    
    <!-- Fallback emoji favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òï</text></svg>">
    
    <!-- External Libraries (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Critical CSS inline for above-the-fold content -->
    <style>
        /* Critical CSS for loading screen */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            font-size: 18px;
            font-weight: 500;
        }
        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
    </style>
    
    <!-- Stylesheets with media queries for better loading -->
    <link rel="stylesheet" href="src/styles/main.css" media="all">
    <link rel="stylesheet" href="src/styles/components/navigation.css" media="all">
    <link rel="stylesheet" href="src/styles/components/sidebar.css" media="all">
    <link rel="stylesheet" href="src/styles/components/dashboard.css" media="all">
    <link rel="stylesheet" href="src/styles/components/charts.css?v=2" media="all">
    <link rel="stylesheet" href="src/styles/components/upload.css" media="all">
    <link rel="stylesheet" href="src/styles/components/settings.css" media="all">
    <link rel="stylesheet" href="src/styles/components/kpi-cards.css" media="all">
    <link rel="stylesheet" href="src/styles/components/channel-cards.css" media="all">
    <link rel="stylesheet" href="src/styles/components/login.css" media="all">
    <link rel="stylesheet" href="src/styles/components/profile-menu.css" media="all">
    <link rel="stylesheet" href="src/styles/components/profile-settings.css" media="all">
    <link rel="stylesheet" href="src/styles/components/preferences.css" media="all">
    <link rel="stylesheet" href="src/styles/components/user-management.css" media="all">
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Chai Vision Dashboard...</div>
    </div>
    
    <!-- Main App Container -->
    <div id="root"></div>
    
    <!-- No Script Warning -->
    <noscript>
        <div class="noscript-warning">
            <h2>JavaScript Required</h2>
            <p>Please enable JavaScript in your browser to use the Chai Vision Dashboard.</p>
        </div>
    </noscript>
    
    <!-- 
    ====================================================================
    MODULE LOADING STRATEGY - OPTIMIZED
    ====================================================================
    For immediate deployment without build tools, we load the modules
    as regular scripts in the correct dependency order with performance optimizations.
    
    First: Data and utilities
    Then: Services
    Then: Components
    Finally: App initialization
    ====================================================================
    -->
    
    <!-- Step 1: Load Initial Data and Utilities -->
    <script src="src/data/initialData.js"></script>
    <script src="src/js/utils/formatters.js?v=dev2"></script>
    <script src="src/js/utils/dateUtils.js"></script>
    <script src="src/js/utils/validators.js"></script>
    <script src="src/js/utils/routing.js"></script>
    
    <!-- Step 2: Load Services -->
    <script src="src/js/services/dataService.js?v=dev6"></script>
    <script src="src/js/services/supabaseService.js?v=dev3"></script>
    
    <!-- Step 3: Load Components -->
    <script src="src/js/components/KPICards.js?v=dev3"></script>
    <script src="src/js/components/ChannelPerformance.js?v=dev3"></script>
    <script src="src/js/components/Charts.js?v=dev9"></script>
    <script src="src/js/components/Dashboard.js?v=dev8"></script>
    <script src="src/js/components/Settings.js?v=dev3"></script>
    <script src="src/js/components/Upload.js?v=dev6"></script>
    <script src="src/js/components/Navigation.js?v=dev3"></script>
    <script src="src/js/components/Sidebar.js"></script>
    <script src="src/js/components/ProfileMenu.js"></script>
    <script src="src/js/components/ProfileSettings.js"></script>
    <script src="src/js/components/Preferences.js"></script>
    <script src="src/js/components/UserManagement.js"></script>
    <script src="src/js/components/Login.js"></script>
    <script src="src/js/utils/notifications.js"></script>
    <script src="src/js/components/AuditLogs.js"></script>
    <!-- Reference overrides disabled to prevent overriding local components -->
    
    <!-- Step 4: Load Configuration -->
    <script src="src/js/config.js"></script>
    
    <!-- Step 5: Load Module Bridge -->
    <script src="src/js/module-bridge.js?v=dev2"></script>
    
    <!-- Step 6: Load Main App -->
    <script src="src/js/app.js?v=dev2"></script>
    
    <!-- Step 7: Initialize Application -->
    <script>
        // Performance monitoring
        const performanceObserver = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
                if (entry.entryType === 'navigation') {
                    console.log('üöÄ Page Load Time:', entry.loadEventEnd - entry.loadEventStart, 'ms');
                    console.log('üöÄ DOM Content Loaded:', entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart, 'ms');
                }
            }
        });
        performanceObserver.observe({ entryTypes: ['navigation'] });

        // Configuration
        const APP_CONFIG = {
            DEBUG_MODE: true,  // Set to false in production
            AUTO_INIT: true,   // Auto-initialize on load
            PERFORMANCE_MODE: true // Enable performance optimizations
        };
        
        // Wait for all scripts to load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM Content Loaded - Checking dependencies...');
            
            // Check dependencies
            const dependencies = {
                'React': typeof React !== 'undefined',
                'ReactDOM': typeof ReactDOM !== 'undefined',
                'Chart.js': typeof Chart !== 'undefined',
                'PapaParse': typeof Papa !== 'undefined',
                'XLSX': typeof XLSX !== 'undefined',
                'Supabase': typeof supabase !== 'undefined'
            };
            
            // Log dependency status
            if (APP_CONFIG.DEBUG_MODE) {
                console.log('üì¶ Dependency Status:');
                Object.entries(dependencies).forEach(([name, loaded]) => {
                    console.log(`  ${loaded ? '‚úÖ' : '‚ùå'} ${name}`);
                });
            }
            
            // Check if all required dependencies are loaded
            const allDepsLoaded = Object.values(dependencies).every(v => v === true);
            
            if (!allDepsLoaded) {
                console.error('‚ùå Not all dependencies loaded. Please check CDN links.');
                showErrorScreen('Dependencies failed to load. Please refresh the page.');
                return;
            }
            
            // Hide loading spinner with optimized timing
            requestAnimationFrame(() => {
                const loadingEl = document.getElementById('loading');
                if (loadingEl) {
                    loadingEl.style.opacity = '0';
                    loadingEl.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        loadingEl.style.display = 'none';
                    }, 300);
                }
            });
            
            // Initialize the app
            if (APP_CONFIG.AUTO_INIT) {
                // Use requestIdleCallback for better performance
                if ('requestIdleCallback' in window) {
                    requestIdleCallback(() => initializeApplication());
                } else {
                    setTimeout(initializeApplication, 0);
                }
            }
        });
        
        // Initialize Application
        function initializeApplication() {
            try {
                // Check if ChaiVision namespace exists
                if (typeof window.ChaiVision !== 'undefined' && 
                    typeof window.ChaiVision.initializeApp === 'function') {
                    console.log('‚úÖ Initializing via ChaiVision namespace...');
                    window.ChaiVision.initializeApp();
                } 
                // Check if global initializeApp exists
                else if (typeof window.initializeApp === 'function') {
                    console.log('‚úÖ Initializing via global function...');
                    window.initializeApp();
                }
                // Fallback to inline initialization
                else {
                    console.warn('‚ö†Ô∏è No initialization function found. Using fallback...');
                    initializeFallbackApp();
                }
            } catch (error) {
                console.error('‚ùå Failed to initialize application:', error);
                showErrorScreen('Failed to initialize. Error: ' + error.message);
            }
        }
        
        // Fallback initialization
        function initializeFallbackApp() {
            const { useState, useEffect, createElement: h } = React;
            
            function FallbackApp() {
                const [initialized, setInitialized] = useState(false);
                
                useEffect(() => {
                    console.log('Fallback app mounted');
                    // Try to load the actual app after a delay
                    setTimeout(() => {
                        if (window.ChaiVision && window.ChaiVision.initializeApp) {
                            window.location.reload();
                        }
                    }, 2000);
                }, []);
                
                return h('div', {
                    style: {
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        minHeight: '100vh',
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        color: 'white',
                        padding: '40px'
                    }
                },
                    h('h1', {
                        style: {
                            fontSize: '48px',
                            marginBottom: '20px',
                            textShadow: '0 2px 4px rgba(0,0,0,0.2)'
                        }
                    }, '‚òï Chai Vision'),
                    h('p', {
                        style: {
                            fontSize: '20px',
                            marginBottom: '40px',
                            opacity: '0.9'
                        }
                    }, 'Sales Performance Dashboard'),
                    h('div', {
                        style: {
                            background: 'rgba(255,255,255,0.2)',
                            borderRadius: '12px',
                            padding: '30px',
                            maxWidth: '500px',
                            textAlign: 'center'
                        }
                    },
                        h('p', {
                            style: {
                                marginBottom: '20px',
                                fontSize: '16px'
                            }
                        }, 'Dashboard modules are loading...'),
                        h('p', {
                            style: {
                                fontSize: '14px',
                                opacity: '0.8'
                            }
                        }, 'If this message persists, please check that all JavaScript files are in the correct locations.'),
                        h('button', {
                            onClick: () => window.location.reload(),
                            style: {
                                marginTop: '20px',
                                padding: '12px 24px',
                                background: 'white',
                                color: '#667eea',
                                border: 'none',
                                borderRadius: '8px',
                                fontSize: '16px',
                                fontWeight: '600',
                                cursor: 'pointer',
                                transition: 'transform 0.2s'
                            },
                            onMouseOver: (e) => e.target.style.transform = 'scale(1.05)',
                            onMouseOut: (e) => e.target.style.transform = 'scale(1)'
                        }, 'Reload Dashboard')
                    )
                );
            }
            
            ReactDOM.render(React.createElement(FallbackApp), document.getElementById('root'));
        }
        
        // Show error screen
        function showErrorScreen(message) {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    min-height: 100vh;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                    color: white;
                    padding: 40px;
                    text-align: center;
                ">
                    <h1 style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è Error</h1>
                    <p style="font-size: 20px; margin-bottom: 20px; max-width: 600px;">${message}</p>
                    <button onclick="window.location.reload()" style="
                        padding: 12px 24px;
                        background: white;
                        color: #ef4444;
                        border: none;
                        border-radius: 8px;
                        font-size: 16px;
                        font-weight: 600;
                        cursor: pointer;
                    ">Reload Page</button>
                </div>
            `;
        }
        
        // Error boundary for production
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            if (APP_CONFIG.DEBUG_MODE) {
                console.error('Stack trace:', event.error?.stack);
            }
        });
        
        // Log successful load
        console.log('‚úÖ Index.html loaded successfully');
    </script>
</body>
</html>
