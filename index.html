<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chai Vision Sales Dashboard - Full Channel Management</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Real-time sales performance tracking across all channels with KPI monitoring and data visualization">
    <meta name="keywords" content="sales dashboard, KPI tracking, business analytics, channel management">
    <meta name="author" content="Chai Vision">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Chai Vision Sales Dashboard">
    <meta property="og:description" content="Real-time sales performance tracking across all channels">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com">
    <meta property="og:image" content="https://your-domain.com/preview.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="public/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="public/apple-touch-icon.png">
    
    <!-- Fallback emoji favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>☕</text></svg>">
    
    <!-- External Libraries (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/components/navigation.css">
    <link rel="stylesheet" href="src/styles/components/sidebar.css">
    <link rel="stylesheet" href="src/styles/components/dashboard.css">
    <link rel="stylesheet" href="src/styles/components/charts.css?v=2">
    <link rel="stylesheet" href="src/styles/components/upload.css">
    <link rel="stylesheet" href="src/styles/components/settings.css">
    <link rel="stylesheet" href="src/styles/components/kpi-cards.css">
    <link rel="stylesheet" href="src/styles/components/channel-cards.css">
    <link rel="stylesheet" href="src/styles/components/login.css">
    <link rel="stylesheet" href="src/styles/components/profile-menu.css">
    <link rel="stylesheet" href="src/styles/components/profile-settings.css">
    <link rel="stylesheet" href="src/styles/components/preferences.css">
    <link rel="stylesheet" href="src/styles/components/user-management.css">
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Chai Vision Dashboard...</div>
    </div>
    
    <!-- Main App Container -->
    <div id="root"></div>
    
    <!-- No Script Warning -->
    <noscript>
        <div class="noscript-warning">
            <h2>JavaScript Required</h2>
            <p>Please enable JavaScript in your browser to use the Chai Vision Dashboard.</p>
        </div>
    </noscript>
    
    <!-- 
    ====================================================================
    MODULE LOADING STRATEGY
    ====================================================================
    For immediate deployment without build tools, we load the modules
    as regular scripts in the correct dependency order.
    
    First: Data and utilities
    Then: Services
    Then: Components
    Finally: App initialization
    ====================================================================
    -->
    
    <!-- Step 1: Load Initial Data and Utilities -->
    <script src="src/data/initialData.js"></script>
    <script src="src/js/utils/formatters.js"></script>
    <script src="src/js/utils/dateUtils.js"></script>
    <script src="src/js/utils/validators.js"></script>
    <script src="src/js/utils/routing.js"></script>
    
    <!-- Step 2: Load Services -->
    <script src="src/js/services/dataService.js"></script>
    <script src="src/js/services/supabaseService.js"></script>
    
    <!-- Step 3: Load Components -->
    <script src="src/js/components/KPICards.js"></script>
    <script src="src/js/components/ChannelPerformance.js"></script>
    <script src="src/js/components/Charts.js"></script>
    <script src="src/js/components/Dashboard.js"></script>
    <script src="src/js/components/Settings.js"></script>
    <script src="src/js/components/Upload.js"></script>
    <script src="src/js/components/Navigation.js"></script>
    <script src="src/js/components/Sidebar.js"></script>
    <script src="src/js/components/ProfileMenu.js"></script>
    <script src="src/js/components/ProfileSettings.js"></script>
    <script src="src/js/components/Preferences.js"></script>
    <script src="src/js/components/UserManagement.js"></script>
    <script src="src/js/components/Login.js"></script>
    <script src="src/js/utils/notifications.js"></script>
    <script src="src/js/components/AuditLogs.js"></script>
    
    <!-- Step 4: Load Configuration -->
    <script src="src/js/config.js"></script>
    
    <!-- Step 5: Load Module Bridge -->
    <script src="src/js/module-bridge.js"></script>
    
    <!-- Step 6: Load Main App -->
    <script src="src/js/app.js"></script>
    
    <!-- Step 7: Initialize Application -->
    <script>
        // Configuration
        const APP_CONFIG = {
            DEBUG_MODE: true,  // Set to false in production
            AUTO_INIT: true    // Auto-initialize on load
        };
        
        // Wait for all scripts to load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 DOM Content Loaded - Checking dependencies...');
            
            // Check dependencies
            const dependencies = {
                'React': typeof React !== 'undefined',
                'ReactDOM': typeof ReactDOM !== 'undefined',
                'Chart.js': typeof Chart !== 'undefined',
                'PapaParse': typeof Papa !== 'undefined',
                'XLSX': typeof XLSX !== 'undefined',
                'Supabase': typeof supabase !== 'undefined'
            };
            
            // Log dependency status
            if (APP_CONFIG.DEBUG_MODE) {
                console.log('📦 Dependency Status:');
                Object.entries(dependencies).forEach(([name, loaded]) => {
                    console.log(`  ${loaded ? '✅' : '❌'} ${name}`);
                });
            }
            
            // Check if all required dependencies are loaded
            const allDepsLoaded = Object.values(dependencies).every(v => v === true);
            
            if (!allDepsLoaded) {
                console.error('❌ Not all dependencies loaded. Please check CDN links.');
                showErrorScreen('Dependencies failed to load. Please refresh the page.');
                return;
            }
            
            // Hide loading spinner
            setTimeout(() => {
                const loadingEl = document.getElementById('loading');
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }
            }, 300);
            
            // Initialize the app
            if (APP_CONFIG.AUTO_INIT) {
                initializeApplication();
            }
        });
        
        // Initialize Application
        function initializeApplication() {
            try {
                // Check if ChaiVision namespace exists
                if (typeof window.ChaiVision !== 'undefined' && 
                    typeof window.ChaiVision.initializeApp === 'function') {
                    console.log('✅ Initializing via ChaiVision namespace...');
                    window.ChaiVision.initializeApp();
                } 
                // Check if global initializeApp exists
                else if (typeof window.initializeApp === 'function') {
                    console.log('✅ Initializing via global function...');
                    window.initializeApp();
                }
                // Fallback to inline initialization
                else {
                    console.warn('⚠️ No initialization function found. Using fallback...');
                    initializeFallbackApp();
                }
            } catch (error) {
                console.error('❌ Failed to initialize application:', error);
                showErrorScreen('Failed to initialize. Error: ' + error.message);
            }
        }
        
        // Fallback initialization
        function initializeFallbackApp() {
            const { useState, useEffect, createElement: h } = React;
            
            function FallbackApp() {
                const [initialized, setInitialized] = useState(false);
                
                useEffect(() => {
                    console.log('Fallback app mounted');
                    // Try to load the actual app after a delay
                    setTimeout(() => {
                        if (window.ChaiVision && window.ChaiVision.initializeApp) {
                            window.location.reload();
                        }
                    }, 2000);
                }, []);
                
                return h('div', {
                    style: {
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        minHeight: '100vh',
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        color: 'white',
                        padding: '40px'
                    }
                },
                    h('h1', {
                        style: {
                            fontSize: '48px',
                            marginBottom: '20px',
                            textShadow: '0 2px 4px rgba(0,0,0,0.2)'
                        }
                    }, '☕ Chai Vision'),
                    h('p', {
                        style: {
                            fontSize: '20px',
                            marginBottom: '40px',
                            opacity: '0.9'
                        }
                    }, 'Sales Performance Dashboard'),
                    h('div', {
                        style: {
                            background: 'rgba(255,255,255,0.2)',
                            borderRadius: '12px',
                            padding: '30px',
                            maxWidth: '500px',
                            textAlign: 'center'
                        }
                    },
                        h('p', {
                            style: {
                                marginBottom: '20px',
                                fontSize: '16px'
                            }
                        }, 'Dashboard modules are loading...'),
                        h('p', {
                            style: {
                                fontSize: '14px',
                                opacity: '0.8'
                            }
                        }, 'If this message persists, please check that all JavaScript files are in the correct locations.'),
                        h('button', {
                            onClick: () => window.location.reload(),
                            style: {
                                marginTop: '20px',
                                padding: '12px 24px',
                                background: 'white',
                                color: '#667eea',
                                border: 'none',
                                borderRadius: '8px',
                                fontSize: '16px',
                                fontWeight: '600',
                                cursor: 'pointer',
                                transition: 'transform 0.2s'
                            },
                            onMouseOver: (e) => e.target.style.transform = 'scale(1.05)',
                            onMouseOut: (e) => e.target.style.transform = 'scale(1)'
                        }, 'Reload Dashboard')
                    )
                );
            }
            
            ReactDOM.render(React.createElement(FallbackApp), document.getElementById('root'));
        }
        
        // Show error screen
        function showErrorScreen(message) {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    min-height: 100vh;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                    color: white;
                    padding: 40px;
                    text-align: center;
                ">
                    <h1 style="font-size: 48px; margin-bottom: 20px;">⚠️ Error</h1>
                    <p style="font-size: 20px; margin-bottom: 20px; max-width: 600px;">${message}</p>
                    <button onclick="window.location.reload()" style="
                        padding: 12px 24px;
                        background: white;
                        color: #ef4444;
                        border: none;
                        border-radius: 8px;
                        font-size: 16px;
                        font-weight: 600;
                        cursor: pointer;
                    ">Reload Page</button>
                </div>
            `;
        }
        
        // Error boundary for production
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            if (APP_CONFIG.DEBUG_MODE) {
                console.error('Stack trace:', event.error?.stack);
            }
        });
        
        // Log successful load
        console.log('✅ Index.html loaded successfully');
    </script>
</body>
</html>
